<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <!-- Mobile Viewport - Critical for APK -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- PWA & Mobile App Meta Tags -->
    <meta name="theme-color" content="#FF6B35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FitCalo">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="FitCalo">

    <!-- Disable phone number detection -->
    <meta name="format-detection" content="telephone=no">

    <!-- MS Tile for Windows -->
    <meta name="msapplication-TileColor" content="#FF6B35">
    <meta name="msapplication-tap-highlight" content="no">

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="FitCalo - Your AI-powered nutrition assistant. Track calories effortlessly with photos and chat. Get instant macro breakdowns powered by Google Gemini AI.">
    <meta name="keywords"
        content="calorie counter, nutrition tracker, AI food recognition, macro tracking, diet app, fitness app">
    <meta name="author" content="FitCalo">

    <!-- Open Graph / Social -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="FitCalo - AI Calorie Counter">
    <meta property="og:description" content="Track calories effortlessly with AI-powered photo recognition and chat.">
    <meta property="og:image" content="icons/icon-512.png">

    <title>FitCalo - AI Calorie Counter | Track Nutrition with Photos</title>

    <!-- Fonts - Inter for premium look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Critical Mobile Styles -->
    <style>
        /* Prevent pull-to-refresh on mobile */
        html,
        body {
            overscroll-behavior-y: contain;
            overflow-x: hidden;
        }

        /* iOS safe areas */
        body {
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* Prevent text selection for UI elements */
        button,
        .card,
        .tab-item,
        .btn,
        .nav-item {
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        /* Allow text selection in inputs */
        input,
        textarea {
            -webkit-user-select: text;
            user-select: text;
        }

        /* Fix iOS input zoom */
        input,
        select,
        textarea {
            font-size: 16px !important;
        }

        /* Smooth momentum scrolling */
        * {
            -webkit-overflow-scrolling: touch;
        }

        /* Hide scrollbar but keep functionality */
        ::-webkit-scrollbar {
            width: 0;
            height: 0;
        }

        /* Prevent tap highlight */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        /* Loading animation */
        @keyframes loadingPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .loading-text {
            animation: loadingPulse 1.5s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- Loading Screen -->
        <div class="loading-screen">
            <div style="text-align: center;">
                <div style="
                    width: 72px; 
                    height: 72px; 
                    background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%); 
                    border-radius: 20px; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    margin: 0 auto 24px;
                    box-shadow: 0 8px 24px rgba(255, 107, 53, 0.32);
                ">
                    <span style="font-size: 2.25rem;">ðŸ¥—</span>
                </div>
                <div class="loader"></div>
                <p class="loading-text"
                    style="margin-top: 16px; font-size: 0.875rem; color: #8585A0; font-weight: 500;">Loading FitCalo...
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Scripts - Order matters! -->
    <script src="js/storage.js"></script>
    <script src="js/gemini.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/onboarding.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/history.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Register Service Worker for offline support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('SW registered'))
                .catch(err => console.log('SW failed', err));
        }

        // Prevent default touch behaviors that cause issues in APK
        document.addEventListener('touchmove', function (e) {
            // Allow scrolling in scrollable areas
            if (e.target.closest('#chat-messages, main, .modal-content, .tab-content')) {
                return;
            }
        }, { passive: true });

        // Handle back button for Android
        window.addEventListener('popstate', function (e) {
            const chatScreen = document.getElementById('chat-screen');

            if (chatScreen) {
                e.preventDefault();
                Chat.close();
            } else if (Dashboard && Dashboard.currentTab !== 'home') {
                e.preventDefault();
                Dashboard.currentTab = 'home';
                Dashboard.update();
                history.pushState({ app: true }, '');
            }
        });

        // Add state for back button handling
        if (window.history && window.history.pushState) {
            window.history.pushState({}, '');
        }

        // Theme persistence on page load
        document.addEventListener('DOMContentLoaded', function () {
            const savedTheme = localStorage.getItem('fitcalo_theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        });
    </script>
</body>

</html>